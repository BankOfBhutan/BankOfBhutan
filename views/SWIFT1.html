<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branch Walk-In Customer Service Queue System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="img/android-chrome-512x512.png"> 
    <!-- Load Open Sans from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/SWIFT.css">
    <style>
        /* Styling for success and error messages */
        .alert {
            position: fixed;
            top: -50px; 
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px; 
            padding: 10px 15px; 
            z-index: 9999;
            text-align: center;
            transition: top 0.5s ease-in-out;
            font-size: 14px; 
            display: none;
        }


        .alert-primary {
            background-color: #13A4DD;
            color: white;
        }

        .alert-danger {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>

<body class="blue-background">
    <!-- Header -->
    <div class="container-fluid bg-white py-3 shadow-sm header-container">
        <div class="row align-items-center">
            <div class="col-auto">
                <img src="image/BOB.png" alt="Bank of Bhutan Logo" class="logo">
            </div>
            <div class="col">
                <h2 class="m-0">Branch Walk-In Customer Service Queue System</h2>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row justify-content-center align-items-stretch">
            <div class="col-md-12">
                <div class="border border-flat p-4 bg-white position-relative">
                    <!-- Success and Error Messages -->
                    <div id="successMessage" class="alert alert-primary" role="alert"></div>
                    <div id="errorMessage" class="alert alert-danger" role="alert"></div>
                    <!-- <button class="btn-close position-absolute top-0 end-0 m-3" aria-label="Close"></button> -->
                    <button id="closeButton" class="btn-close position-absolute top-0 end-0 m-3" aria-label="Close"></button>


                    <h3 class="text-start topic  mb-4">Online Token Generator</h3>
                    <p class="text-start mb-3">Selected service is SWIFT</p>

                    <hr class="custom-hr">

                    <div class="row mb-3 align-items-center justify-content-between">
                        <div class="col-md-6">
                           <p class="text-start mb-3 mt-4">Please fill the form</p>
                 
                        </div>
                        <div class="col-md-6 d-flex justify-content-end align-items-center ref-container">
                            <label class="form-label me-2 mb-0 bank-ref-label">Bank Application Ref.No:</label>
                            <span class="ref-line"></span> 
                        </div>
                    </div>
                    <h5 class="text-start mb-3 " >SWIFT-MT 103</h5>

                    <hr class="custom-hr">
                    <!-- Form: Single Customer Credit Transfer -->
                    <form id="swiftForm">
                        <p class="text-start">Single Customer Credit Transfer</p>
                        <h6 class="text-start mb-3 mt-4" >Sender Reference:</h6>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="passportNo" class="form-label">Passport No/ ID Card No</label>
                                <input type="text" id="passportNo" class="form-control" placeholder="Enter Passport No/ID No">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="productDetails" class="form-label">Product Details</label>
                                <input type="text" id="productDetails" class="form-control" placeholder="Enter product details">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="issuedDate" class="form-label">Issued Date (YYYY-MM-DD)</label>
                                <input type="text" id="issuedDate" class="form-control" placeholder="yyyy-mm-dd" maxlength="10">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="expiryDate" class="form-label">Expiry Date (YYYY-MM-DD)</label>
                                <input type="text" id="expiryDate" class="form-control" placeholder="yyyy-mm-dd" maxlength="10">
                            </div>
                        </div>
                        
                        

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="currencyType" class="form-label">Currency</label>
                                <input type="text" id="currencyType" class="form-control" placeholder="Enter the currency type">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="amount" class="form-label">Amount</label>
                                <input type="text" id="amount" class="form-control" placeholder="Enter the amount in BTN">
                            </div>
                            
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="valueDate" class="form-label">Value Date (YYYY-MM-DD)</label>
                                <input type="text" id="valueDate" class="form-control" placeholder="yyyy-mm-dd" maxlength="10">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="tokenNumber" class="form-label">Token Number</label>
                                <input type="text" id="tokenNumber" name="tokenNumber" value="" readonly>
                            </div>
                            
                            
                        </div>
                        <hr class="custom-hr">
                        <!-- Ordering Customer Section -->
                        <h6 class="text-start">Ordering Customer</h6>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="orderingCustomerName" class="form-label">Name</label>
                                <input type="text" id="orderingCustomerName" class="form-control" placeholder="Enter Ordering Customer Name">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="orderingCustomerAddress" class="form-label">Address</label>
                                <input type="text" id="orderingCustomerAddress" class="form-control" placeholder="Enter Ordering Customer Address">
                            </div>
                        </div>
                        <hr class="custom-hr">
                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="intermediaryBank" class="form-label">Intermediary Bank-SWIFT BIC</label>
                                <input type="text" id="intermediaryBank" class="form-control" placeholder="Enter BIC (Optional)">
                            </div>
                        </div>
                        <hr class="custom-hr">

                        <!-- Beneficiary Bank Details Section -->
                        <h6 class="text-start">Beneficiary Bank Details</h6>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="bankName" class="form-label">Bank Name</label>
                                <input type="text" id="bankName" class="form-control" placeholder="Enter bank name">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="bankAddress" class="form-label">Bank Address</label>
                                <input type="text" id="bankAddress" class="form-control" placeholder="Enter bank address">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="swiftCode" class="form-label">SWIFT Code</label>
                                <input type="text" id="swiftCode" class="form-control" placeholder="Enter the CODE">
                            </div>
                        </div>
                        <hr class="custom-hr">
                        <!-- Beneficiary Customer Details Section -->
                        <h6 class="text-start">Beneficiary Customer Details</h6>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="beneficiaryName" class="form-label">Name</label>
                                <input type="text" id="beneficiaryName" class="form-control" placeholder="Enter name">
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="beneficiaryAccount" class="form-label">Account No</label>
                                <input type="text" id="beneficiaryAccount" class="form-control" placeholder="Enter account no">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6 form-group">
                                <label for="beneficiaryAddress" class="form-label">Address</label>
                                <input type="text" id="beneficiaryAddress" class="form-control" placeholder="Enter address">
                            </div>
                        </div>

                        <hr class="custom-hr">
                        <!-- Purpose of Payment -->
                        <h6 class="text-start">Purpose</h6>
                        <div class="mb-3">
                            <div class="d-flex flex-wrap gap-3">
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="bill_payment"> Bill payment
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="education"> Education
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="medical"> Medical
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="salary"> Salary
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="gov_fund"> Government Fund
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="purpose" value="others"> Others
                                </label>
                            </div>
                            <div class="col-md-6 mt-3 form-group">
                                <input type="text" id="otherPurpose" class="form-control" placeholder="If others please specify">
                            </div>
                        </div>
                        
                   
                     <!-- Terms of Payment section -->
                        <h6 class="text-start">Term of Payment</h6>
                        <div class="mb-3" id="termsOfPayment" style="display: none;">
                            <div class="d-flex flex-wrap gap-3">
                                <label class="radio-label">
                                    <input type="radio" name="paymentTerm" id="advancePayment" value="advance_payment"> Advance payment
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="paymentTerm" id="finalPayment" value="final_payment"> Final payment
                                </label>
                            </div>
                            <!-- Declaration No Field -->
                            <div class="col-md-6 mt-3 form-group" id="declarationNoField" style="display: none;">
                                <label for="declarationNo" class="form-label">Declaration No</label>
                                <input type="text" id="declarationNo" class="form-control" placeholder="Enter the Declaration No">
                            </div>
                        </div>

                         <hr class="custom-hr">
                        <!-- Details of Charges Section -->
                        <h6 class="text-start">Details of Charges</h6>
                        <div class="mb-3">
                            <div class="d-flex flex-wrap gap-3">
                                <label class="radio-label">
                                    <input type="radio" name="charges" value="our"> Our
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="charges" value="beneficiary"> Beneficiary
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="charges" value="share"> Share
                                </label>
                            </div>
                        </div>

                        <button type="submit" id="submitBtn" class="submit-btn btn btn-primary">Submit Form</button>  
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-4 py-4 footer-custom">
        <div class="container">
            <p>&copy; 2024 <a href="#" class="text-decoration-none" style="color: #00A7E3;">Bank of Bhutan</a>. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            function autoFormatDate(input) {
                // Remove all non-digit characters
                let value = input.value.replace(/\D/g, '');
                
                // Format the input to YYYY-MM-DD
                if (value.length >= 5) {
                    input.value = value.substring(0, 4) + '-' + value.substring(4, 6) + (value.length > 6 ? '-' + value.substring(6, 8) : '');
                } else if (value.length >= 3) {
                    input.value = value.substring(0, 4) + '-' + value.substring(4, 6);
                } else {
                    input.value = value;
                }
            }
        
            // Add event listeners for both date input fields
            document.getElementById('issuedDate').addEventListener('input', function () {
                autoFormatDate(this);
            });
        
            document.getElementById('expiryDate').addEventListener('input', function () {
                autoFormatDate(this);
            });

            document.getElementById('valueDate').addEventListener('input', function () {
                autoFormatDate(this);
            });
        </script>


        <script>
            // Show error message and hide it after 5 seconds
            function showError(message) {
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                errorMessage.style.top = '20px';
                setTimeout(() => {
                    errorMessage.style.top = '-100px'; // Slide up
                    setTimeout(() => {
                        errorMessage.style.display = 'none'; // Hide completely after sliding up
                    }, 500); // Wait for the sliding up animation to finish
                }, 5000); // Keep the message visible for 5 seconds
            }

            // Show success message and hide it after 5 seconds
            function showSuccess(message) {
                const successMessage = document.getElementById('successMessage');
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                successMessage.style.top = '20px';
                setTimeout(() => {
                    successMessage.style.top = '-100px'; // Slide up
                    setTimeout(() => {
                        successMessage.style.display = 'none'; // Hide completely after sliding up
                    }, 500); // Wait for the sliding up animation to finish
                }, 5000); // Keep the message visible for 5 seconds
            }

        
            // Validate form fields
            function validateForm() {
                const errors = [];
                const email = document.getElementById('email').value.trim();
                const passportNo = document.getElementById('passportNo').value.trim();
                const productDetails = document.getElementById('productDetails').value.trim();
                const issuedDate = document.getElementById('issuedDate').value.trim();
                const expiryDate = document.getElementById('expiryDate').value.trim();
                const valueDate = document.getElementById('valueDate').value.trim();
                const currencyType = document.getElementById('currencyType').value.trim();
                const amount = document.getElementById('amount').value.trim();
                const orderingCustomerName = document.getElementById('orderingCustomerName').value.trim();
                const orderingCustomerAddress = document.getElementById('orderingCustomerAddress').value.trim();
                const bankName = document.getElementById('bankName').value.trim();
                const bankAddress = document.getElementById('bankAddress').value.trim();
                const swiftCode = document.getElementById('swiftCode').value.trim();
                const beneficiaryName = document.getElementById('beneficiaryName').value.trim();
                const beneficiaryAccount = document.getElementById('beneficiaryAccount').value.trim();
                const purpose = document.querySelector('input[name="purpose"]:checked');
                const paymentTerm = document.querySelector('input[name="paymentTerm"]:checked');
                const declarationNo = document.getElementById('declarationNo').value.trim();
                const charges = document.querySelector('input[name="charges"]:checked');
        
                // Validate required fields
                if (!passportNo) errors.push('Passport No/ID Card No is required.');
                if (!productDetails) errors.push('Product details are required.');
                if (!issuedDate || !isValidDate(issuedDate)) errors.push('Issued Date is required and must be in YYYY-MM-DD format.');
                if (!expiryDate || !isValidDate(expiryDate)) errors.push('Expiry Date is required and must be in YYYY-MM-DD format.');
                if (!valueDate || !isValidDate(valueDate)) errors.push('Value Date is required and must be in YYYY-MM-DD format.');
                if (!currencyType) errors.push('Currency type is required.');
                if (!amount || isNaN(amount) || amount <= 0) errors.push('Amount is required and must be a positive number.');
                if (!orderingCustomerName) errors.push('Ordering Customer Name is required.');
                if (!orderingCustomerAddress) errors.push('Ordering Customer Address is required.');
                if (!bankName) errors.push('Beneficiary Bank Name is required.');
                if (!bankAddress) errors.push('Beneficiary Bank Address is required.');
                if (!swiftCode) errors.push('SWIFT Code is required.');
                if (!beneficiaryName) errors.push('Beneficiary Name is required.');
                if (!beneficiaryAccount) errors.push('Beneficiary Account Number is required.');
                if (!purpose) errors.push('Purpose of payment is required.');
                if (!charges) errors.push('Details of charges are required.');
        
                // Validate the Declaration No if "Final Payment" is selected
                if (paymentTerm && paymentTerm.value === 'final_payment' && !declarationNo) {
                    errors.push('Declaration No is required for Final Payment.');
                }
        
                // Display errors if any
                if (errors.length > 0) {
                    showError(errors.join(' '));
                    return false;
                }
        
                return true;
            }
        
            // Function to check if a date is valid
            function isValidDate(dateString) {
                const date = new Date(dateString);
                return !isNaN(date.getTime());
            }
        
            window.addEventListener('DOMContentLoaded', (event) => {
                // Get necessary elements
                const billPaymentRadio = document.querySelector('input[name="purpose"][value="bill_payment"]');
                const educationRadio = document.querySelector('input[name="purpose"][value="education"]');
                const otherPurposeRadios = document.querySelectorAll('input[name="purpose"]:not([value="bill_payment"], [value="education"])');
                const termsOfPayment = document.getElementById('termsOfPayment');
                const finalPaymentRadio = document.getElementById('finalPayment');
                const advancePaymentRadio = document.getElementById('advancePayment');
                const declarationNoField = document.getElementById('declarationNoField');
                const submitBtn = document.getElementById('submitBtn');
        
                // Initially hide the Terms of Payment and Declaration No fields
                termsOfPayment.style.display = 'none';
                declarationNoField.style.display = 'none';
        
                // Show "Terms of Payment" section only when "Bill Payment" is selected
                billPaymentRadio.addEventListener('click', function() {
                    termsOfPayment.style.display = 'block'; 
                });
        
                // Hide "Terms of Payment" when any other purpose is selected
                otherPurposeRadios.forEach(function(radio) {
                    radio.addEventListener('click', function() {
                        termsOfPayment.style.display = 'none';
                        declarationNoField.style.display = 'none'; 
                    });
                });
        
                // Show "Declaration No." field when "Final Payment" is selected
                finalPaymentRadio.addEventListener('click', function() {
                    declarationNoField.style.display = 'block'; 
                });
        
                // Hide "Declaration No." field when "Advance Payment" is selected
                advancePaymentRadio.addEventListener('click', function() {
                    declarationNoField.style.display = 'none';
                });
        
                // Change the submit button text and hide the "Terms of Payment" when "Education" is selected
                educationRadio.addEventListener('click', function() {
                    submitBtn.textContent = 'Next';
                    termsOfPayment.style.display = 'none'; 
                });
        
                // Reset the submit button text to "Submit Form" and show "Terms of Payment" for "Bill Payment"
                billPaymentRadio.addEventListener('click', function() {
                    submitBtn.textContent = 'Submit Form';
                    termsOfPayment.style.display = 'block'; 
                });
        
                // Add event listener for submit button click
                submitBtn.addEventListener('click', function(event) {
                    event.preventDefault(); 
        
                    // Validate form before submission
                    if (validateForm()) {
                        // Collect form data
                        const formData = {
                            email: document.getElementById('email').value.trim(), // Collect email correctly
                            passportNo: document.getElementById('passportNo').value.trim(),
                            productDetails: document.getElementById('productDetails').value.trim(),
                            issuedDate: document.getElementById('issuedDate').value.trim(),
                            expiryDate: document.getElementById('expiryDate').value.trim(),
                            valueDate: document.getElementById('valueDate')?.value.trim(),
                            currencyType: document.getElementById('currencyType').value.trim(),
                            amount: document.getElementById('amount').value.trim(),
                            orderingCustomerName: document.getElementById('orderingCustomerName').value.trim(),
                            orderingCustomerAddress: document.getElementById('orderingCustomerAddress').value.trim(),
                            bankName: document.getElementById('bankName').value.trim(),
                            bankAddress: document.getElementById('bankAddress').value.trim(),
                            swiftCode: document.getElementById('swiftCode').value.trim(),
                            beneficiaryName: document.getElementById('beneficiaryName').value.trim(),
                            beneficiaryAccount: document.getElementById('beneficiaryAccount').value.trim(),
                            beneficiaryAddress: document.getElementById('beneficiaryAddress').value.trim(),
                            purpose: document.querySelector('input[name="purpose"]:checked').value,
                            paymentTerm: document.querySelector('input[name="paymentTerm"]:checked')?.value || null,
                            declarationNo: document.getElementById('declarationNo')?.value || null,
                            charges: document.querySelector('input[name="charges"]:checked').value,
                            service: "SWIFT",
                        };
        
                        console.log('Form Data:', formData);
        
                        // If "Education" is selected, store the form data and redirect to SWIFT2.html
                        if (educationRadio.checked) {
                            localStorage.setItem('swiftFormData', JSON.stringify(formData));
                            window.location.href = 'SWIFT2.html'; 
                        } else {
                            // If another purpose is selected, submit the form data
                            fetch('https://bankofbhutan-w3qb.onrender.com/api/v1/walkinswift/submit-swift', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(formData),
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.status === 'success') {
                                    showSuccess('SWIFT form submitted successfully!');
                                    setTimeout(() => {
                                        window.location.href = 'Email.html?service=SWIFT'; 
                                    }, 3000);
                                } else {
                                    showError(result.message || 'Form submission failed.');
                                }
                            })
                            .catch(error => {
                                console.error('Error submitting form:', error);
                                showError('An error occurred while submitting the form.');
                            });
                        }
                    }
                });
        
                document.querySelector('.btn-close').addEventListener('click', function () {
                    window.location.href = '/Token.html';
                });
            });
        </script>

         <script>
              window.onload = function() {
            const tokenNumber = localStorage.getItem('storedToken');
            if (tokenNumber) {
                document.getElementById('tokenNumber').value = tokenNumber;
            } else {
                alert('No token found in cache. Please get a new token.');
            }
        };
         </script>
        
        
        
</body>
</html>
